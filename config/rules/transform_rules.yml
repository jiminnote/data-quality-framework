# ==========================================
# 변환 로직 검증 규칙 정의
# ==========================================
# ETL 변환 전후 데이터 정합성 검증

transform_rules:
  - rule_id: "TRF-001"
    description: "거래 금액 합계 정합성 (소스 vs 타겟)"
    source_query: >
      SELECT SUM(transaction_amount) AS total_amount
      FROM src_card_transactions
      WHERE transaction_amount IS NOT NULL
    target_query: >
      SELECT SUM(transaction_amount) AS total_amount
      FROM tgt_card_transactions
    compare_column: "total_amount"
    tolerance: 0.01  # 소수점 차이 허용
    enabled: true

  - rule_id: "TRF-002"
    description: "일별 거래 집계 합계 정합성"
    source_query: >
      SELECT DATE(transaction_date) AS tx_date,
             SUM(transaction_amount) AS daily_total
      FROM src_card_transactions
      WHERE transaction_amount IS NOT NULL
      GROUP BY DATE(transaction_date)
    target_query: >
      SELECT summary_date AS tx_date,
             total_amount AS daily_total
      FROM tgt_daily_summary
    join_key: "tx_date"
    compare_column: "daily_total"
    tolerance: 0.01
    enabled: true

  - rule_id: "TRF-003"
    description: "거래 건수 집계 정합성"
    source_query: >
      SELECT DATE(transaction_date) AS tx_date,
             COUNT(*) AS tx_count
      FROM src_card_transactions
      GROUP BY DATE(transaction_date)
    target_query: >
      SELECT summary_date AS tx_date,
             transaction_count AS tx_count
      FROM tgt_daily_summary
    join_key: "tx_date"
    compare_column: "tx_count"
    tolerance: 0
    enabled: true

  - rule_id: "TRF-004"
    description: "고객 ID 매핑 정합성 (소스 → 타겟)"
    source_query: >
      SELECT customer_id
      FROM src_customers
    target_query: >
      SELECT customer_id
      FROM tgt_customers
    join_key: "customer_id"
    compare_type: "existence"
    enabled: true
